##### PREFIX & SCREEN-LIKE BEHAVIOR #####

# Use Ctrl-a as prefix (screen-like)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Use Vi mode for copy + status
set -g mode-keys vi
set -g status-keys vi

# Enable mouse support
set -g mouse on

##### SPLITS & WINDOW MANAGEMENT #####

# Screen-like window splitting
unbind %
unbind '"'
bind S split-window -v          # Ctrl-a S (horizontal split, like screen)
bind | split-window -h          # Ctrl-a | (vertical split, like screen)

# Screen-like window management
bind c new-window               # Ctrl-a c (create window)
bind A command-prompt -I "#W" "rename-window '%%'"  # Ctrl-a A (rename window)
bind '"' choose-window          # Ctrl-a " (window list)

# Screen-like window navigation
bind space next-window          # Ctrl-a space (next window)
bind n next-window              # Ctrl-a n (next window)
bind p previous-window          # Ctrl-a p (previous window)
bind 0 select-window -t 0
bind 1 select-window -t 1
bind 2 select-window -t 2
bind 3 select-window -t 3
bind 4 select-window -t 4
bind 5 select-window -t 5
bind 6 select-window -t 6
bind 7 select-window -t 7
bind 8 select-window -t 8
bind 9 select-window -t 9

# Session management
bind d detach-client            # Ctrl-a d (detach)
bind k confirm-before -p "kill-window #W? (y/n)" kill-window  # Ctrl-a k (kill window)

# Copy mode + paste
bind [ copy-mode                # Ctrl-a [
bind ] paste-buffer             # Ctrl-a ]

# Pane navigation
bind tab select-pane -t :.+     # Ctrl-a Tab (cycle panes)

##### TERMINAL / TRUECOLOR / GHOSTTY #####

# Use tmux-256color for proper capabilities
set -g default-terminal "tmux-256color"

# Make sure truecolor works with xterm-256color / screen-256color / Ghostty
set -ga terminal-overrides ",xterm-256color:RGB,screen-256color:RGB,ghostty:RGB,tmux-256color:RGB"

# Focus events (neovim, etc)
set -g focus-events on

##### ENVIRONMENT / AGENT FORWARDING #####

# Make sure SSH agent env vars survive into panes
set -g update-environment "SSH_AUTH_SOCK SSH_AGENT_PID"

##### SCROLLBACK & PERFORMANCE #####

# Bigger history for travel / debugging
set -g history-limit 20000

# No delay for escape key press (good for vim)
set -g escape-time 0

# Don't let tmux exit when last session ends
set -g exit-empty off

##### STATUS BAR / TITLES #####

# Terminal emulator window title
set -g set-titles on
# default: '#S:#I.#P #W'
set -g set-titles-string '#S:#W [#I.#P]'

# Status bar styling
set -g status-bg colour238
set -g status-fg white
setw -g window-status-current-style bg=black,fg=green

set -g status-left-length 40
set -g status-right-length 80
set -g status-interval 15

# Simple static status bar
set -g status-left '#[fg=colour39]#S #[fg=green]» '
#set -g status-right ' #[fg=green]« #[fg=colour39]#h #[fg=colour39]%I:%M'
set -g status-right ' #[fg=green]« #[fg=colour39]%I:%M'
setw -g window-status-format '#[dim]  #I:#W  #[default]'
setw -g window-status-current-format ' #I:#W '


# Pane borders & messages
set -g pane-border-style fg=colour238
set -g pane-active-border-style fg=colour39
set -g message-style bg=colour16,fg=colour166

##### INDEXING / RENAMING #####

# Start window & pane numbering at 1 (screen-like)
set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on

# Automatic window renaming
setw -g automatic-rename on
setw -g automatic-rename-format '#{b:pane_current_path}'

##### MOVEMENT & RESIZE KEYS (VI-LIKE) #####

# Pane navigation
bind h select-pane -L           # Ctrl-a h
bind j select-pane -D           # Ctrl-a j
bind k select-pane -U           # Ctrl-a k
bind l select-pane -R           # Ctrl-a l

# Pane killing
bind X kill-pane                # Ctrl-a X

# Pane resize
bind C-h resize-pane -L 5       # Ctrl-a Ctrl-h
bind C-j resize-pane -D 5       # Ctrl-a Ctrl-j
bind C-k resize-pane -U 5       # Ctrl-a Ctrl-k
bind C-l resize-pane -R 5       # Ctrl-a Ctrl-l

##### COPY MODE / CLIPBOARD (MACOS) #####

# Better copy mode (vi-style)
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi r send-keys -X rectangle-toggle

# Copy to tmux buffer only (fallback)
bind -T copy-mode-vi Y send-keys -X copy-selection-and-cancel

# Copy to macOS clipboard via pbcopy (primary)
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

# Enable OSC 52 / clipboard integration where possible
set -g set-clipboard on

##### SESSION / WINDOW UTILITIES #####

bind s choose-session           # Ctrl-a s (session list)
bind $ command-prompt -I "#S" "rename-session '%%'"  # Ctrl-a $

# Quick window swapping
bind < swap-window -t -1\; select-window -t -1
bind > swap-window -t +1\; select-window -t +1

# More screen-like key bindings
bind ? list-keys                # Ctrl-a ? (help)
bind : command-prompt
